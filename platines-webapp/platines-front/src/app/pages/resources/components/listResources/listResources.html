<!--

    (c) Copyright 2017-2024, ANS. All rights reserved.

-->
<div class="widgets">
  <div class="col-lg-12 col-md-12">
    <div class="card">

      <nav aria-label="Fil d'ariane" class="breadcrumb-wrapper" role="navigation">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/pages/accueil" translate>pages.home.title
            <svg aria-hidden="true" class="svg-icon svg-angle-right" focusable="false">
              <use xlink:href="svg-icons/icon-sprite.svg#angle-right"></use>
            </svg>
          </a></li>
          <li class="breadcrumb-item"><a routerLink="./" translate>pages.resources.title</a></li>
        </ol>
      </nav>

      <div class="card-header clearfix">
        <h3 class="card-title" translate>pages.resources.title</h3>
      </div>
      <div class="card-body">
        <div class="col-md-12 info">
          <div class="col-md-5 treecol">
                <app-project-list-tree
                  treeTitle="Arborescence des thèmes"
                  frameHeight="60rem"
                  withHeader="true"
                  (nodeClick)="onEvent($event)"
                  [activeNodes]="[activeNode]"
                  [projectObs]="resourceSrc">
                </app-project-list-tree>
          </div>
          <div class="col-md-7 treecol">
            <div class="div-info ">
              <div >
                <mat-tab-group>
                  <mat-tab class="tab-header" label="{{'commons.labels.description'|translate}}">
                    <div>
                      <pre class="description">{{description}}</pre>
                    </div>
                  </mat-tab>
                  <mat-tab *ngIf="touched" label="{{'commons.labels.documents' | translate}}">
                    <div class="description">
                      <div class="drop-zone">
                        <ngx-file-drop (onFileDrop)="dropped($event)">

                        </ngx-file-drop>
                      </div>
                      <div class="files-table table-responsive">
                        <table [dataSource]="filesTableDataSource" class="mat-elevation-z8" mat-table>

                          <ng-container matColumnDef="fileName">
                            <th *matHeaderCellDef mat-header-cell>Nom</th>
                            <td [ngClass]="{'warning-text':filesToDelete.includes(element)}" *matCellDef="let element" mat-cell>{{element.fileName}}</td>
                          </ng-container>

                          <ng-container matColumnDef="resourceType">
                            <th *matHeaderCellDef mat-header-cell>Type</th>
                            <td *matCellDef="let element" mat-cell>
                              <mat-select (selectionChange)="markAsTouched(element)" panelClass="custom-mat-select-panel" disableOptionCentering class="form-control" [(value)]="element.resourceType">
                                <mat-option *ngFor="let role of getAvailableRoles(element) | keyvalue" [value]="role.key">
                                  {{role.value}}
                                </mat-option>
                              </mat-select>
                              <span class="warning-text" *ngIf="!element.resourceType">Choisir le type de ressource</span>
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="actions">
                            <th *matHeaderCellDef mat-header-cell>Actions</th>
                            <td *matCellDef="let element" mat-cell>
                              <span>
                                <button>Modifier la version</button>
                              </span>
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="checkbox">
                            <th *matHeaderCellDef mat-header-cell>
                              <div class="custom-control text-center custom-checkbox">
                                <input (click)="setAll($event)" [checked]="isAllSelected()" [indeterminate]="!isAllSelected() && filesTableSelection.hasValue()" class="custom-control-input" type="checkbox">
                              </div>
                            </th>
                            <td *matCellDef="let element" mat-cell>
                              <div class="custom-control text-center custom-checkbox">
                                <input (change)="setRow(element)" [checked]="filesTableSelection.isSelected(element)" class="custom-control-input" type="checkbox">
                              </div>
                            </td>
                          </ng-container>

                          <tr *matNoDataRow>
                            <td class="text-center" colspan="5">Pas de ressources associées pour : {{this.scope}}</td>
                          </tr>

                          <tr *matHeaderRowDef="allColumns" mat-header-row></tr>
                          <tr *matRowDef="let emprow; columns: allColumns" mat-row></tr>
                        </table>

                      </div>
                      <div class="divBtn">
                        <button (click)="reset()" class="btn btn--default btn--ghost" type="submit">
                          <span translate>commons.actions.cancel</span>
                        </button>
                        <button (click)="delete()" class="btn btn--default btn--ghost" type="submit">
                          <span translate>commons.actions.delete</span>
                        </button>
                        <button [disabled]="!(filesToUpload.length>0||filesToDelete.length>0||touchedResources.length>0)" (click)="validate()" class="btn btn--plain btn--primary" type="submit">
                          <span translate>commons.actions.validate</span>
                        </button>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

